<!DOCTYPE html>
<html lang="bs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kviz</title>

    <link rel="stylesheet" href="kviz.css">

    <!-- PDF generator -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        /* Modal fix */
        .hidden { display: none !important; }

        .modal {
            position: fixed; 
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); 
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
    </style>
</head>
<body>

<div class="container">
    <h1 class="title">Studentski Kviz</h1>

    <!-- KVIZ -->
    <div id="quiz-box">
        <div id="progress">
            <div id="progress-bar"></div>
        </div>

        <h2 id="question">Učitavam pitanje...</h2>

        <div id="answers"></div>

        <button id="next-btn" class="hidden">Dalje</button>
    </div>

    <!-- REZULTATI -->
    <div id="result-box" class="hidden">
        <h2>Rezultat</h2>
        <p id="score-text"></p>

        <div class="result-buttons" style="display:flex; gap:10px; flex-wrap:wrap;">
            <button onclick="startQuiz()">Ponovo</button>
            <button id="pdfBtn">Preuzmi kao PDF</button>
            <button id="emailBtn">Pošalji mailom</button>
        </div>
    </div>
</div>

<!-- EMAIL MODAL -->
<div id="emailModal" class="modal hidden">
    <div style="
        background: white; padding: 20px; width: 300px; border-radius: 10px;
        text-align: center; color: black; display:flex; flex-direction:column;">

        <h3>Pošalji rezultat na email</h3>

        <input type="email" id="emailInput" placeholder="Unesite email..." style="
            width: 90%; padding: 10px; margin-top: 10px; border: 1px solid #ccc;
            border-radius: 5px;">

        <div style="margin-top: 20px;">
            <button id="emailSend" style="
                padding: 8px 15px; margin-right: 10px; background: #3498db;
                color: white; border: none; border-radius: 5px;">Pošalji</button>

            <button id="emailCancel" style="
                padding: 8px 15px; background: #777; color: white;
                border: none; border-radius: 5px;">Poništi</button>
        </div>
    </div>
</div>


<script>
/* PDF EXPORT */
document.addEventListener("DOMContentLoaded", () => {
    const pdfBtn = document.getElementById("pdfBtn");
    if (pdfBtn) {
        pdfBtn.addEventListener("click", function () {
            const { jsPDF } = window.jspdf;

            html2canvas(document.querySelector("#result-box")).then(canvas => {
                const imgData = canvas.toDataURL("image/png");

                const pdf = new jsPDF({
                    orientation: "portrait",
                    unit: "px",
                    format: "a4"
                });

                const pageWidth = pdf.internal.pageSize.getWidth();
                const ratio = pageWidth / canvas.width;
                const imgWidth = canvas.width * ratio;
                const imgHeight = canvas.height * ratio;

                pdf.addImage(imgData, "PNG", 0, 20, imgWidth, imgHeight);
                pdf.save("kviz-rezultat.pdf");
            });
        });
    }

    /* EMAIL SLANJE pripravljeno"
*/
    const emailBtn = document.getElementById("emailBtn");
    const emailModal = document.getElementById("emailModal");
    const emailSend = document.getElementById("emailSend");
    const emailCancel = document.getElementById("emailCancel");
    const emailInput = document.getElementById("emailInput");

    emailBtn.addEventListener("click", () => {
        emailModal.classList.remove("hidden");
    });

    emailCancel.addEventListener("click", () => {
        emailModal.classList.add("hidden");
        emailInput.value = "";
    });

    emailSend.addEventListener("click", () => {
        const email = emailInput.value.trim();
        if (email === "") {
            alert("Unesite email adresu!");
            return;
        }

        const scoreText = document.getElementById("score-text").textContent;
        const subject = "Rezultat kviza";
        const body = "Vaš rezultat:\n\n" + scoreText;

        window.location.href =
            `mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;

        emailModal.classList.add("hidden");
        emailInput.value = "";
    });
});
</script>

<script src="kviz.js"></script>
</body>
</html>
